# --- Servidor NFS (10.0.0.200) ---
sudo apt update && sudo apt install -y nfs-kernel-server

# Crear carpeta compartida y dar permisos
sudo mkdir -p /srv/nfs/OS3
sudo chown nobody:nogroup /srv/nfs/OS3
sudo chmod 755 /srv/nfs/OS3

# Crear 100 archivos de prueba
for i in {1..100}; do sudo touch "/srv/nfs/OS3/Adrian $i.txt"; done

# Configurar export para el cliente específico (10.0.0.201)
echo "/srv/nfs/OS3 10.0.0.201(rw,sync,no_subtree_check)" | sudo tee -a /etc/exports

# Exportar y reiniciar NFS
sudo exportfs -ra
sudo systemctl restart nfs-kernel-server

# --- Cliente NFS (10.0.0.201) ---
sudo apt update && sudo apt install -y nfs-common

# Crear punto de montaje y montar
sudo mkdir -p /mnt/OS3
sudo mount 10.0.0.200:/srv/nfs/OS3 /mnt/OS3

# Hacer el montaje persistente en /etc/fstab
echo "10.0.0.200:/srv/nfs/OS3 /mnt/OS3 nfs defaults 0 0" | sudo tee -a /etc/fstab

# Probar desmontando y montando de nuevo
sudo umount /mnt/OS3
sudo mount -a

# --- Verificación ---
ls -1 /mnt/OS3

# Reiniciar para comprobar que monta automáticamente
sudo reboot
ls -1 /mnt/OS3


# --- OPCIÓN: Compartir con toda la red 10.0.0.0/24 ---
# Editar exports
sudo nano /etc/exports
# Contenido para permitir a toda la subred:
# /srv/nfs/OS3 10.0.0.0/24(rw,sync,no_subtree_check)

# Aplicar cambios
sudo exportfs -ra
sudo systemctl restart nfs-kernel-server

# Ahora cualquier equipo de la red puede montar:
# sudo mount 10.0.0.200:/srv/nfs/OS3 /mnt/OS3
